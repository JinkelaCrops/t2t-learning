# 语料QA系统设计

经过了多个项目: 语料清洗(独立程序)，语料筛选(用于NMT)，QA(用于YICAT)，文本分类(CNN Classify)，对语料QA有了一些粗浅的
认识，在此基础上整理语料QA的标准化操作流程，并形成系统，以后再次遇到相似的任务，可以直接根据文档进行开发。

## 语料QA的目标

语料QA任务可分为三块，一块是检查，一块是修改，一块是筛选。
* 在检查任务中，语料QA系统将语料映射到自己，并生成基于QA规则的日志
* 在修改任务中，语料QA系统将语料映射到修改过后的语料，语料规模相同，单句质量提高，整体质量提高，不生成任何日志
* 在筛选任务中，语料QA系统将语料映射到筛选过后的语料，语料规模变短，单句质量不变，整体质量提高，不生成任何日志

### 检查任务

检查任务的目标是: 对每一条语料，尽可能准确地报告全部QA规则的内容。因此，问题的关键是理解QA规则，这在最开始提出规则时
就应该明确，且要全面考虑极端情况、边界情况。

1. 尽可能准确地报告全部QA规则
    * 要求开发人员准确地理解QA规则

在此基础上，还应当根据每个项目的特殊性，加入特有的目标。在我接触的全部任务中，比较有代表性的几个目标如下：
1. 尽可能快速地执行QA
    * 要求开发人员使用更加高效的手段书写QA规则执行方法，例如使用正则表达式而不是字符串遍历，多个QA规则复用同一个处理结果
    * 要求开发人员更好地利用系统资源，例如使用并发编程
2. 尽可能少地生成日志
    * 要求开发人员对QA规则进行合并，并给QA规则分级
    * 要求开发人员解决QA规则的冲突，对原始QA规则进行修订升级
    * 根据产品和前端的需求修改QA日志的输出格式

例如，在语料打分评估项目中，那么意味着一个工程会被执行多次，那么就需要在满足**准确报告**的基础上，增加**快速执行**的
目标，此外，还应当设计一个QA日志打分系统。在翻译结果QA报告项目中，涉及到用户查看QA日志的体验问题，应当在满足
**准确报告**的基础上，增加**快速执行**和**减少日志**，合并不同QA规则的报告，提高用户体验。


### 修改任务

修改任务的目标是: 对每一条语料，在不改变原来语料含义的基础上，尽可能多地清理无效字符和无意义片段，标准化语料。
语料的含义是一个很模糊的概念，因此修改任务比检查任务和筛选任务都要困难。

由于语料修改涉及到字符替换，因此不能够简单视作一种序列标记问题。事实上，语料清洗最好的开发工具还是正则表达式。

1. 尽可能多地清理无效字符
    * 要求开发人员构建出一套字符集工具，将全部的unicode编码映射到自己能够操作的字符集上，保证操作粒度的可选择性。
    * 要求开发人员制定出特殊字符映射关系，使用上一步开发出的字符集工具，将特殊字符映射到正常字符。这一步稍微涉及到一点
      语料含义的问题，比如英文中不同的连字符，应当统一映射到常用的连字符`-`。
    * 要求开发人员筛选出字符白名单或黑名单。如果语料涉及到的字符过于庞大，而要求高质量的修改后语料，那么应当在解决特殊
      字符映射关系的基础上使用白名单。
2. 尽可能多地清理无意义片段
    * 要求开发人员总结出无意义片段的具体规则，比如html标签，序号。
    * 要求开发人员书写高效的无意义片段清理程序，并解决冲突。例如html片段中有全角字符，html片段被转义，有意义的片段被html
      包裹等等。由于不可能穷尽全部的特殊情况，而很多时候人自己也不能正确处理，因此需要自己抽样查看
3. 标准化语料
    * 要求开发人员对语料进行格式统一及词干化处理，具体的处理规则可以借鉴**检查任务**中的QA规则
4. 不改变原来的语料含义
    * 要求开发人员通过抽样，根据语义对语料进行分类整理。对每个特定的类，指定判断为误删的规则。由于统计维度问题，类可以有
      交叉，但是一条语句的任意两个规则不能够冲突。
    * 要求开发人员根据每个类自定义清理规则，控制前三条规则的强度，保证没有误删。
    
在此基础上，还应当根据每个项目的特殊性，加入特有的目标。可以使用**检查任务**中的**快速执行**和**减少日志**。


### 筛选任务

筛选任务的目标是: 对每一条语料，根据一定的筛选规则进行打分，挑选出得分超过阈值的语料。筛选规则类似**检查任务**中的QA规则
，一般和具体的任务结合，比如机器翻译，需要根据不同的条件配置不同的筛选规则，比如想要挑选出和中英文中数字对照的语料，
那么筛选中就应该加入中英文中数字对照这一条件。


